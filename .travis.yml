language: python
python:
  - "2.7"

services:
  - docker

before_install:
- docker pull e96tech/consul-server
- docker pull nginx
- docker run -d -p 8500:8500 --name consul e96tech/consul-server -advertise 127.0.0.1 -bootstrap -dc docker -domain test -server
- docker run -d --net=host -v $NGINX_CONFIG_PATH:$NGINX_CONFIG_PATH --name nginx nginx
- docker ps -a
- docker logs consul
- echo -e '#!/bin/sh\nexec docker exec nginx nginx $@' > "$NGINX_BINARY" && chmod +x "$NGINX_BINARY"
- mkdir $DATA_PATH $NGINX_CONFIG_PATH

env:
 - NGINX_BINARY="$(pwd)/nginx.sh" DATA_PATH="$(pwd)/data" NGINX_CONFIG_PATH="$DATA_PATH/nginx" SECRET=travis

install: "python src/setup.py install"
script: nosetests

